name: Docker Image CI

on:
  pull_request:
    branches: [ "master" ]
    paths:
      - 'Dockerfile'
      - 'build_docker.sh'
      - '.dockerignore'

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    # Free up disk space before building
    - name: Free Disk Space
      run: |
        echo "Disk space before cleanup:"
        df -h

        # Remove unnecessary pre-installed software
        sudo rm -rf /usr/share/dotnet
        sudo rm -rf /usr/local/lib/android
        sudo rm -rf /opt/ghc
        sudo rm -rf /opt/hostedtoolcache/CodeQL

        # Clean apt cache
        sudo apt-get clean
        sudo apt-get autoremove -y
        sudo apt-get autoclean -y

        # Remove Docker images and containers
        docker system prune -a -f

        echo "Disk space after cleanup:"
        df -h

    - name: Build the Docker image
      run: bash build_docker.sh
